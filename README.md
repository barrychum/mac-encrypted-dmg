# Encrypted Disk Image Management Scripts

This repository contains scripts for managing encrypted disk images (DMG) on macOS. The scripts provide functionality to generate a unique encryption key, create and mount an encrypted DMG, and unmount the DMG when no longer needed.

## For the impatient
Copy the scripts to a folder in PATH.  The followings are the most basic usage

```
new-encryptedDMG.sh 
```
This will create an encrypted drive $HOME/enctmp.  The dmg file is $HOME/.enctmp.dmg and it is only usable in the same machine and user.

```
umount-encryptedDMG.sh -d
```
This will umount and delete the $HOME/.enctmp.dmg



## Scripts

### 1. `derive-key.sh`

**Purpose**: Generates a unique encryption key based on machine ID and user ID.  This is only a helper function.  You can eaily modify this script to add your own salt to generate a key that is unique for your purpose.

**Usage**:
```bash
./derive-key.sh
```

- The script outputs the derived encryption key which can be used in other scripts or applications.

### 2. `new-encryptedDMG.sh`

**Purpose**: Creates a new encrypted DMG and mounts it to a specified mount point.

**Usage**:
```bash
./new-encryptedDMG.sh [--size=<size_in_MB>] [--volname=<folder name>]
```

**Parameters**:
- `<size_in_MB>`: Size of the DMG in megabytes.
- `<folder name>`: Mount point where the DMG will be mounted.

**Instructions**:
- Once created, the encrypted DMG is mounted to the specified `$HOME/<folder name>`.

### 3. `umount-encryptedDMG.sh`

**Purpose**: Unmounts the encrypted DMG.

**Usage**:
```bash
./umount-encryptedDMG.sh [--volname=<folder name>] [--delete]
```

**Parameters**:
- `<folder name>`: Mount point of the DMG to unmount.
- `--delete`: delete the associated DMG file.

**Instructions**:
- Ensure the DMG is not in use (e.g., close open files) before unmounting.


## Security Considerations

- **Encryption**: The scripts utilize strong encryption methods to secure sensitive data stored in the DMG.
- **Key Management**: Ensure proper management of encryption keys to maintain data confidentiality.
- **Usage**: Use these scripts responsibly and ensure they are adapted to meet specific security and operational requirements.



### Key Strength and Resistance to Brute Force Attacks

The encryption key generated by `derive-key.sh` combines `machine_uuid` and `generated_uid`, resulting in a key space that is:
- **Large**: The combination of machine UUID (typically 128 bits) and user UUID (varies, but typically 128 bits or more) results in a significantly large key space.
- **Unique**: Each machine has a unique `machine_uuid`, and each user session typically has a unique `generated_uid`, further increasing the uniqueness of the derived key.
- **Resistant to Brute Force**: The sheer size of the key space makes it computationally infeasible to brute force the encryption key within a reasonable timeframe.

### Usage Scenario

When using this derived encryption key for creating an encrypted folder to store sensitive information temporarily, consider the following:

- **Temporary Storage**: The key is suitable for temporary storage of sensitive data where robust encryption is required.
- **Security Best Practices**: Always ensure the encrypted DMG is properly unmounted when not in use to maintain data security.
- **Key Management**: Protect the derived key appropriately and ensure it is not exposed or stored insecurely.

## License

This project is licensed under the [MIT License](LICENSE).

